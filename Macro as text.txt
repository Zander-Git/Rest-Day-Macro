'==========================================
' Title:  Rest day calculation macro
' Author: Zander O'Callaghan
' Date:   13 June 2019
'==========================================
Public Catch As Long
Public startCol, iRowNum, iColNum As Integer
Sub RestDayRule()
'
'Next goal could be to have cells for user to define the starting cell and
'   for what defines a Rest/annual leave day
'

'Declare dimmensions
Dim ws As Worksheet
Set ws = Sheets("sheet1")
Dim cellValue, cellPos, varAnnual, varRestAn, varRest As String
Dim leaveCheck, EndLoop As Boolean
Catch = 0

'These variables are for the start point of the macro
'Should be the top left of the numbers
startCol = 5
iRowNum = 5
iColNum = startCol

'Variables for what to look for in the data
'varAnnual is for whatever is annual leave
'varRestAn is for rest days next to annual leave
'varRest is for rest days
varAnnual = "a"
varRestAn = "r_"
varRest = "r"

With Sheets("Sheet1")
Do While EndLoop = False

'Starts the cellValue from the variables aboves
cellValue = .Cells(iRowNum, iColNum)

Select Case cellValue

    Case varAnnual, varRestAn
    'When either positive var is found, either side of the cell is checked
        If Cells(iRowNum, iColNum + 1) = varRest Then
            Cells(iRowNum, iColNum + 1) = varRestAn
            Call StartLine
        ElseIf Cells(iRowNum, iColNum - 1) = varRest Then
            Cells(iRowNum, iColNum - 1) = varRestAn
            Call StartLine
        Else
            Call NextCell
        End If
        
    Case varRest
    'When a rest day is found, either side of the cell is checked for either positive variables
        If Cells(iRowNum, iColNum + 1) = varAnnual Then
          Cells(iRowNum, iColNum) = varRestAn
          Call StartLine
        ElseIf Cells(iRowNum, iColNum - 1) = InStr(1, cellValue, varAnnual) Or InStr(1, cellValue, varRestAn) Then
            Cells(iRowNum, iColNum) = varRestAn
            Call StartLine
        Else
        Call NextCell
        End If
        
    Case vbNullString
        'MsgBox "empty boi"
        Call NextLine
    Case Else
        Call NextCell
    'Else
        'Call Error
    End Select
        
Catch = Catch + 1
    
If (Catch = 500000) Then
    MsgBox "The catch was triggered"
    EndLoop = True
ElseIf IsEmpty(cellValue) = True Then
    cellValue = .Cells(iRowNum, iColNum)
    If IsEmpty(cellValue) = True Then
        'MsgBox "Done :)"
        'MsgBox Catch
        MsgBox "done :)"
        EndLoop = True
    End If
End If
Loop
End With
End Sub
Sub NextCell()
' Used to make the method above go to next cell
iColNum = iColNum + 1
End Sub
Sub NextLine()
' Used to make the method above go to next line
iRowNum = iRowNum + 1
Call StartLine
End Sub
Sub StartLine()
'Starts the process at the start of the current line
iColNum = startCol
End Sub
Sub Error()
MsgBox "Error"
End Sub